---
- name: Get info about running services
  service_facts:

- name: Install systemd service
  template:
    src: adguardhome.service.j2
    dest: "/etc/systemd/system/{{ adguardhome_service_name }}.service"
    mode: "0664"
  register: adguardhome_systemd_unit
  notify:
    - reload systemd daemon
    - restart adguardhome

- name: Apply configuration settings
  template:
    src: adguardhome.yml.j2
    dest: "{{ adguardhome_config_file }}"
    mode: 0644
    owner: "{{ adguardhome_user }}"
    group: "{{ adguardhome_user }}"
  notify:
    - stop adguardhome service
    - apply adguardhome configuration settings
    - start && enable adguardhome service
